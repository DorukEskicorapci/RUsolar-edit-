/*
 * state.c
 *
 *  Created on: Dec 15, 2024
 *      Author: Nathaniel Correa
 */

#include "state.h"

#include <stdint.h>

void init_state(mainboard_state_t* state) {
	state->motor_rpm = 0;
	state->motor_forward = true;
	state->motor_power = true;
	state->motor_contactor_requested = false;
	state->main_power_requested = false;
	state->car_speed = 0;
	state->timestamp = HAL_GetTick();
}

void state_recalculate(mainboard_state_t* state, mainboard_state_t* last, float rpm, float speed) {
	state->timestamp = HAL_GetTick();
	state->motor_contactor_requested = !HAL_GPIO_ReadPin(SW_CON_MOT_GPIO_Port, SW_CON_MOT_Pin);
	state->main_power_requested = !HAL_GPIO_ReadPin(SW_CON_BATT_GPIO_Port, SW_CON_BATT_Pin);
	state->motor_rpm = rpm;
	state->car_speed = speed;
}
